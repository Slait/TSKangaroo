(c) 2024, RetiredCoder (RC)

RCKangaroo - бесплатное программное обеспечение с открытым исходным кодом (GPLv3).
Это программное обеспечение демонстрирует эффективную GPU-реализацию современного метода Kangaroo для решения ECDLP. 
Это часть #3 моего исследования, более подробную информацию можно найти здесь: https://github.com/RetiredC

Ветка обсуждения: https://bitcointalk.org/index.php?topic=5517607

<b>Дополнения RCKangaroo-Fork</b>
Единственные изменения, которые я внес, касаются взаимодействия программы с командной строкой. Теперь все, что вам нужно ввести - это DP, Range и Public Key. Программа автоматически определит смещение и битовый диапазон на основе введенного -range. 
Пример:
```
RCKangaroo.exe -dp 14 -range 200000000000000000:400000000000000000 -pubkey 0290e6900a58d33393bc1097b5aed31f2e4e7cbd3e5466af958665bc0121248483
```

Результат:
Пример:
```
Это программное обеспечение бесплатное и с открытым исходным кодом: https://github.com/RetiredC
Оно демонстрирует быструю GPU-реализацию современного метода Kangaroo для решения ECDLP
Версия для Windows
Начальный диапазон: 200000000000000000
Конечный диапазон: 400000000000000000
Биты: 70
CUDA устройства: 1, CUDA драйвер/среда выполнения: 12.6/12.6
GPU 0: NVIDIA GeForce RTX 4090, 23.99 ГБ, 128 CU, возможности 8.9, PCI 1, размер L2: 73728 КБ
Общее количество GPU для работы: 1

ОСНОВНОЙ РЕЖИМ

Решение публичного ключа
X: 90E6900A58D33393BC1097B5AED31F2E4E7CBD3E5466AF958665BC0121248483
Y: D7319F127105F492FD15E009B103B4A83295722F28F07C95F9A5443EF8E77CE0
Смещение: 200000000000000000

Решение точки: Диапазон 70 бит, DP 14, начинаем...
Метод SOTA, оценочные операции: 2^35.202, ОЗУ для DP: 0.277 ГБ. Накладные расходы DP и GPU не включены!
Оценочные DP на кенгуру: 3.067. Накладные расходы DP большие, используйте меньшее значение DP если возможно!
GPU 0: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU запущены...
MAIN: Скорость: 8090 MKeys/s, Ошибки: 0, DP: 2350K/2411K, Время: 0д:00ч:00м:05с/0д:00ч:00м:04с

Остановка работы ...
Общее время: 7 секунд
Точка решена, K: 1.373 (с накладными расходами DP и GPU)


ПРИВАТНЫЙ КЛЮЧ: 349B84B6431A6C4EF1
```

Я тестировал его до 100 бит, результаты:
```
Это программное обеспечение бесплатное и с открытым исходным кодом: https://github.com/RetiredC
Оно демонстрирует быструю GPU-реализацию современного метода Kangaroo для решения ECDLP
Версия для Linux
Начальный диапазон: 000000000000000000000008000000000000000000000000
Конечный диапазон: 00000000000000000000000fffffffffffffffffffffffff
Биты: 99
CUDA устройства: 8, CUDA драйвер/среда выполнения: 12.4/12.0
GPU 0: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 1, размер L2: 73728 КБ
GPU 1: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 65, размер L2: 73728 КБ
GPU 2: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 98, размер L2: 73728 КБ
GPU 3: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 129, размер L2: 73728 КБ
GPU 4: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 161, размер L2: 73728 КБ
GPU 5: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 193, размер L2: 73728 КБ
GPU 6: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 194, размер L2: 73728 КБ
GPU 7: NVIDIA GeForce RTX 4090, 23.64 ГБ, 128 CU, возможности 8.9, PCI 225, размер L2: 73728 КБ
Общее количество GPU для работы: 8

ОСНОВНОЙ РЕЖИМ

Решение публичного ключа
X: 4ECC524F1F53F525A7224364A4290BA97D72298D885FCF93B6E139E802B421B9
Y: 77621A8FCABAD9A502611EBB502359CE874065C1D0F5AF246028B38545B8990A
Смещение: 0000000000000000000000000000000000000008000000000000000000000000

Решение точки: Диапазон 99 бит, DP 24, начинаем...
Метод SOTA, оценочные операции: 2^49.702, ОЗУ для DP: 2.220 ГБ. Накладные расходы DP и GPU не включены!
Оценочные DP на кенгуру: 8.674.
GPU 0: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 1: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 2: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 3: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 4: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 5: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 6: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU 7: выделено 2394 МБ, 786432 кенгуру. OldGpuMode: Нет
GPU запущены...
MAIN: Скорость: 59748 MKeys/s, Ошибки: 0, DP: 37036K/54571K, Время: 0д:02ч:54м:38с/0д:04ч:15м:23с

Остановка работы ...
Общее время: 2 часа, 54 минуты, 41 секунда
Точка решена, K: 0.781 (с накладными расходами DP и GPU)


ПРИВАТНЫЙ КЛЮЧ: 000000000000000000000000000000000000000F4A21B9F5CE114686A1336E07
```

Релиз для Windows в разделе Release был собран с Cuda 12.6 и compute_89,sm_89;compute_86,sm_86;compute_75,sm_75;compute_61,sm_61. Должен работать на большинстве современных GPU. Или вы можете скачать и скомпилировать самостоятельно.

<b>Особенности:</b>

- Самый низкий K=1.15, что означает в 1.8 раза меньше требуемых операций по сравнению с классическим методом с K=2.1, а также в 1.8 раза меньше памяти для хранения DP.
- Быстро, около 8GKeys/s на RTX 4090, 4GKeys/s на RTX 3090.
- Сохраняет накладные расходы DP минимальными.
- Поддерживает диапазоны до 170 бит.
- Поддерживаются и Windows, и Linux.

<b>Ограничения:</b>

- Нет расширенных функций, таких как сеть, сохранение/загрузка DP и т.д.

<b>Параметры командной строки:</b>

<b>-gpu</b>		какие GPU используются, например, "035" означает, что используются GPU #0, #3 и #5. Если не указано, используются все доступные GPU. 

<b>-pubkey</b>		публичный ключ для решения, поддерживаются сжатые и несжатые ключи. Если не указан, программа запускается в режиме бенчмарка и решает случайные ключи. 

<b>-start</b>		начальное смещение ключа в шестнадцатеричном формате. Обязательно, если указана опция "-pubkey". Например, для головоломки #85 начальное смещение "1000000000000000000000". 

<b>-range</b>		битовый диапазон приватного ключа. Обязательно, если указана опция "-pubkey". Например, для головоломки #85 битовый диапазон "84" (84 бита). Должен быть в диапазоне 32...170. 

<b>-dp</b>		биты DP. Должны быть в диапазоне 14...60. Низкие значения битов DP вызывают увеличение БД, но уменьшают накладные расходы DP и наоборот. 

<b>-max</b>		опция для ограничения максимального количества операций. Например, значение 5.5 ограничивает количество операций до 5.5 * 1.15 * sqrt(range), программа останавливается при достижении лимита. 

<b>-tames</b>		имя файла с tames. Если файл не найден, программа генерирует tames (требуется опция "-max") и сохраняет их в файл. Если файл найден, программа загружает tames для ускорения решения. 

Когда публичный ключ решен, программа отображает его и также записывает в файл "RESULTS.TXT". 

Пример командной строки для головоломки #85:

RCKangaroo.exe -dp 16 -range 84 -start 1000000000000000000000 -pubkey 0329c4574a4fd8c810b7e42a4b398882b381bcd85e40c6883712912d167c83e73a

Пример команды для генерации tames:

RCKangaroo.exe -dp 16 -range 76 -tames tames76.dat -max 10

Затем вы можете перезапустить программу с теми же параметрами, чтобы увидеть меньший K в режиме бенчмарка или добавить "-tames tames76.dat" для более быстрого решения публичного ключа в 76-битном диапазоне.

<b>Некоторые заметки:</b>

Самые быстрые решатели ECDLP всегда будут использовать метод SOTA/SOTA+, поскольку он в 1.4/1.5 раза быстрее и требует меньше памяти для DP по сравнению с лучшими 3-сторонними кенгуру с K=1.6. 
Даже если у вас уже есть более быстрая реализация прыжков кенгуру, внедрение метода SOTA улучшит её ещё больше. 
Хотя добавление необходимого кода обработки циклов приведёт к потере около 5–15% вашей текущей скорости, сам метод SOTA обеспечит 40% прирост производительности. 
В общем, это приводит к примерно 25% чистому улучшению, что не следует игнорировать, если ваша цель - создать действительно быстрый решатель. 


<b>Журнал изменений:</b>

v3.0:

- добавлены опции "-tames" и "-max".
- исправлены некоторые ошибки.

v2.0:

- добавлена поддержка карт 30xx, 20xx и 1xxx.
- некоторые незначительные изменения.

v1.1:

- добавлена возможность запуска программы на картах 30xx.

v1.0:

- первоначальный релиз.

# Сборка и запуск под Windows 11 (Visual Studio 2022)

## Требования
- Visual Studio 2022 (Desktop development with C++)
- CUDA Toolkit (11.x или новее, совместимый с вашей видеокартой)
- Драйверы NVIDIA (актуальные)

## Сборка
1. Откройте `RCKangaroo.sln` в Visual Studio 2022.
2. Убедитесь, что выбран Release/x64.
3. Проверьте путь к CUDA Toolkit (Project Properties → CUDA C/C++ → Common → CUDA Toolkit Custom Dir).
4. Соберите проект (Build Solution).

## Запуск
- Запустите из Visual Studio или из командной строки:
  ```
  RCKangaroo.exe -range 78 -dp 16 -pubkey <X> <Y>
  ```
- Для теста производительности используйте BENCHMARK MODE (без -pubkey).

## Внедренные оптимизации (v1.1)

### 1. Улучшенное копирование данных (3-7% ускорение)
- Оптимизированные макросы `Copy_u64_x4_vectorized` для лучшего копирования
- Функция `OptimizedCopy256` с архитектурно-зависимыми улучшениями
- Применено в критических участках копирования jump tables

### 2. Архитектурно-зависимая оптимизация памяти (5-12% ускорение)
- Адаптивное использование shared memory:
  - RTX 40xx+: до 227KB shared memory
  - RTX 30xx: до 164KB shared memory  
  - Старые архитектуры: 48KB
- Лучшая коалесценция памяти с `__restrict__` указателями

### 3. Уменьшение warp divergence (3-8% ускорение)
- Функция `ConditionalNegModP` использует маскированные операции
- Убирает условные переходы в горячих циклах
- Повышает эффективность выполнения warp'ов

### Ожидаемый прирост производительности:
- **RTX 40xx серии**: 10-20% ускорение
- **RTX 30xx серии**: 8-15% ускорение  
- **Старые архитектуры**: 5-10% ускорение

## Тестирование оптимизаций
- Все инверсии на GPU используют проверенную функцию InvModP.
- Векторизированные операции автоматически выбираются для поддерживаемых архитектур.
- Корректность проверяется сравнением результатов CPU и CUDA (MAIN и BENCHMARK режимы).

## Примечания
- Для максимальной производительности используйте современные GPU (Ampere, Ada Lovelace).
- Для профилирования используйте Nsight Systems/Compute.
- Все оптимизации сохраняют полную совместимость с исходным алгоритмом.